---
- hosts:
    all
  name:
    Download archive and link executable

  vars_files:
    - vars/paths.yaml

  tasks:
    - name:
        Initialize release store path
      file:
        path:
          "{{ release_store_path }}"
        state:
          directory

    - name:
        Unarchive
      unarchive:
        src:
          "{{ url }}"
        dest:
          "{{ release_store_path }}"
        remote_src:
          yes
        list_files:
          yes
      register:
        extract_path
      tags:
        download

    - name:
        Link executable
      file:
        src:
          "{{ release_store_path }}/{{ extract_path.files[0].split('/') | first }}/{{ link_src }}"
        path:
          "{{ user_bin }}/{{ link_dest | default(link_src | basename) }}"
        state:
          link
      when:
        link_src | default(false)
      tags:
        link
