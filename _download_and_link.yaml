---
- hosts:
    all
  name:
    Download archive and link executable

  vars_files:
    - vars/paths.yaml

  tasks:
    - name:
        Initialize release store path
      file:
        path:
          "{{ release_store_path }}"
        state:
          directory

    - name:
        Download and unarchive {{ url }}
      unarchive:
        src:
          "{{ url }}"
        dest:
          "{{ release_store_path }}"
        remote_src:
          yes
        list_files:
          yes
      register:
        extract_path
      tags:
        download

    - name:
        Link executable
      file:
        src:
          "{{ release_store_path }}/{{ extract_path.files[0].split('/') | first }}/{{ item.src }}"
        path:
          "{{ user_bin }}/{{ item.dest | default(item.src | basename) }}"
        state:
          link
      when:
        link | default(false)
      with_items:
        "{{ link }}"
      tags:
        link
